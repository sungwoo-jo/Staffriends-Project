<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board.mapper.BoardMapper">
    <select id="selectBoardList" resultType="board.vo.BoardVo" parameterType="Map"> -- 게시판 목록
        <![CDATA[
            SELECT
                board_idx,
                title,
                hit_cnt,
                DATE_FORMAT(created_datetime, '%Y.%m.%d %H:%i:%s') AS created_datetime
            FROM
                t_board
            WHERE
                deleted_yn = 'N'
            ORDER BY board_idx DESC
            LIMIT #{start}, #{pageLength}
        ]]>
    </select>

    <select id="getTotalRows" resultType="int"> -- 총 데이터 개수 구하기
        <![CDATA[
            SELECT
                count(*)
            FROM
                t_board
        ]]>
    </select>
    
    <insert id="insertBoard" parameterType="board.vo.BoardVo"> -- 글쓰기
        <![CDATA[
            INSERT INTO t_board
                (
                    title,
                    contents,
                    created_datetime,
                    creator_id
                )
            VALUES
                (
                   #{title},
                   #{contents},
                   now(),
                   'admin'
                )
            ]]>
    </insert>

    <update id="updateHitCount" parameterType="int"> -- 조회수 증가
        <![CDATA[
            UPDATE
                t_board
            SET
                hit_cnt = hit_cnt + 1
            WHERE
                board_idx = #{boardIdx} -- 게시판 목록 중 게시판 번호가 DB의 게시판 번호와 같은 글
        ]]>
    </update>

    <select id="selectBoardDetail" parameterType="int" resultType="board.vo.BoardVo"> -- 글 상세보기
        <![CDATA[
            SELECT
                board_idx, title, contents, hit_cnt,
                DATE_FORMAT(created_datetime, '%Y.%m.%d %H:%i:%s') AS created_datetime,
                creator_id
            FROM
                t_board
            WHERE
                board_idx = #{boardIdx} AND deleted_yn = 'N'
        ]]>
    </select>

    <update id="updateBoard" parameterType="board.vo.BoardVo"> -- 글 수정
        <![CDATA[
            UPDATE
                t_board
            SET
                title = #{title},
                contents = #{contents},
                updated_datetime = now(),
                updater_id = 'admin'
            WHERE
                board_idx = #{boardIdx}
        ]]>
    </update>

    <update id="deleteBoard" parameterType="int"> -- 글 삭제
        <![CDATA[
            UPDATE
                t_board
            SET
                deleted_yn = 'Y',
                updated_datetime = now(),
                updater_id = 'admin'
            WHERE
                board_idx = #{boardIdx}
        ]]>
    </update>
</mapper>